Passo a passo para corrigir erro ECONNREFUSED na Evolution API (127.0.0.1:3000)

1. Verifique se o servidor Evolution API está em execução:
   • No Shell do Replit, rode:
     ps aux | grep evolution-api
     ps aux | grep node
   • Se não encontrar o processo, inicie o serviço:
     cd evolution-api-main
     npm install
     npm run dev
     # ou
     node dist/main.js

2. Ajuste a porta e URL da API no seu backend:
   • Se a Evolution API deve escutar na porta 3000:
     - No arquivo `.env` ou variáveis de ambiente do Replit:
       EVOLUTION_API_URL=http://localhost:3000
   • Se estiver rodando em outra porta (ex.: 5000):
     - Atualize para:
       EVOLUTION_API_URL=http://localhost:5000

3. Configure corretamente o serviço Evolution no Replit:
   • Abra `evolutionApiService.ts` e confirme:
     const apiUrl = process.env.EVOLUTION_API_URL || 'http://localhost:3000';
   • Use sempre `fetch(apiUrl + '/instance')` para criar nova instância.

4. Teste se a API responde:
   • No Shell:
     curl http://localhost:3000
   • Deve retornar:
     {
       "status":200,
       "message":"Welcome to the Evolution API, it is working!",
       "version":"1.x.x",
       ...
     }

5. Reinicie a aplicação principal:
   • No projeto principal (backend):
     npm run dev
   • Isso garante que o novo `EVOLUTION_API_URL` seja usado.

6. Valide a conexão:
   • Faça POST em `/api/whatsapp-client/connect` novamente.
   • Se não houver ECONNREFUSED, a conexão estará sendo encaminhada para
     o servidor Evolution API ativo.

Se mesmo após estas etapas o erro persistir, verifique:
- Firewalls internos do Replit não bloquearem a porta.
- Se outra instância não esteja ocupando a porta (use `lsof -i :3000`).
- Se o código da Evolution API não apresentou erros ao iniciar (logs).

Salve este conteúdo como **fix_evolution_api_connection.txt** no Replit.
